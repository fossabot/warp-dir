#!/usr/bin/env ruby
require 'bundler/setup'
require 'warp/dir'
require 'slop'

if ARGV[0] && !ARGV[0][0].eql?('-')
  ARGV.unshift('--command')
end

opts = Slop::Options.new
opts.banner = %Q{
  Usage: wd [ --command ] [ show | list | clean | validate | wipe ]          [ flags ]
         wd [ --command ] [ add  [ -f/--force ] | rm | ls | path ] <point>   [ flags ]
         wd --help | help

  Warp Point Commands:
    add   <point>   Adds the current directory as a new warp point
    rm    <point>   Removes a warp point
    show  <point>   Show the path to the warp point
    ls    <point>   Show files from tne warp point
    path  <point>   Show the path to given warp point

  Global Commands:
    show            Print warp points to current directory
    list            Print all stored warp points
    clean           Remove points warping to nonexistent directories
    help            Show this extremely unhelpful text

  Flags:}
opts.string '-m', '--command',  'command to run, ie. add, ls, list, rm, etc.'
opts.bool   '-h', '--help',     'show help'
opts.bool   '-v', '--verbose',  'enable verbose mode'
opts.bool   '-q', '--quiet',    'suppress output (quiet mode)'
opts.string '-c', '--config',   'location of the configuration file (default: ' + Warp::Dir.config + ')', default: Warp::Dir.config
opts.on     '-V', '--version',  'print the version' do
  puts "Version " + Warp::Dir::VERSION
  exit
end

parser = Slop::Parser.new(opts)
result = parser.parse(ARGV)

if result.help?
  puts result
  exit 0
end

config = Warp::Dir::Config.new(result.to_hash)
store = Warp::Dir::Store.new(config)

case config.command
  when 'list'
    Warp::Dir::Point.print(store.points_map)
  else
    puts 'Unknown command ' + config[:command]
    exit 0
end

if config.verbose
  require 'pp'
  pp result.to_hash
end


